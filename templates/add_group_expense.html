{% extends "layout.html" %}
{% block title %}Add Group Expense{% endblock %}
{% block main %}

<div class="container content-container">
  <h3 class="mb-4">Add Expense to {{ group.name }}</h3>
  <form method="POST">

    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <input type="text" class="form-control" name="description" required>
    </div>

    <div class="mb-3">
      <label for="amount" class="form-label">Total Amount</label>
      <input type="number" class="form-control" name="amount" id="amount" step="0.01" required>
    </div>

    <div class="mb-3">
      <label for="paid_by" class="form-label">Paid By</label>
      <select class="form-select" name="paid_by" id="paid_by" required>
        {% for user in users %}
          <option value="{{ user.id }}" {% if user.id == session["user_id"] %}selected{% endif %}>
            {{ user.name.split(" ")[0] }}
          </option>
        {% endfor %}
      </select>
    </div>
    

    <h5 class="mt-4 mb-3">Split Among Members</h5>
    {% for user in users %}
      <div class="mb-2">
        <label>{{ user.name.split(' ')[0] }}'s Share</label>
        <input type="number" step="0.01" name="user_{{ user.id }}" class="form-control split-input" value="0" required>
      </div>
    {% endfor %}

    <button type="submit" class="btn btn-success mt-3">Add Expense</button>
    <a href="{{ url_for('group_page', group_id=group.id) }}" class="btn btn-secondary mt-3">Cancel</a>

  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const amountInput = document.getElementById("amount");
    const splitInputs = document.querySelectorAll(".split-input");

    amountInput.addEventListener("input", () => {
      const total = parseFloat(amountInput.value) || 0;
      const share = (total / splitInputs.length).toFixed(2);

      splitInputs.forEach(input => {
        input.value = share;
      });
    });
  });
</script>

{% endblock %}
